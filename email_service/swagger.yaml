openapi: 3.0.0
info:
  title: Email Service
  version: 1.0.0
  description: Service for processing email notifications from a message queue, filling templates with variables, and sending emails.
servers:
  - url: http://localhost:3002
    description: Local Development Server (if applicable for health checks)
tags:
  - name: Health
    description: Health check endpoint for service status.
  - name: Message Queue
    description: Message patterns consumed by the Email Service from RabbitMQ.
components:
  schemas:
    EmailJobData:
      type: object
      required:
        - user_id
        - notification_type
        - variables
        - user_data
        - template_content
        - correlation_id
      properties:
        user_id:
          type: string
          format: uuid
          description: The UUID of the user to send the email to.
          example: "550e8400-e29b-41d4-a716-446655440000"
        template_id:
          type: string
          format: uuid
          description: The ID of the template used for the email (optional, kept for backward compatibility).
          example: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
        template_code:
          type: string
          description: The template code/name used for the email (e.g., "welcome_email").
          example: "welcome_email"
        notification_type:
          type: string
          enum:
            - email
          description: The type of notification, always 'email' for this service.
          example: "email"
        variables:
          type: object
          additionalProperties:
            type: string
          description: Key-value pairs for variable substitution in the template.
          example:
            name: "John Doe"
            product: "Awesome Product"
        user_data:
          type: object
          description: User-specific data fetched from the User Service.
          example:
            email: "john.doe@example.com"
            name: "John Doe"
        template_content:
          type: string
          description: The template content with variables already substituted by the Template Service.
          example: "Hello John Doe, welcome to Awesome Product!"
        correlation_id:
          type: string
          format: uuid
          description: The unique ID for tracking the notification lifecycle.
          example: "a1b2c3d4-e5f6-7890-1234-567890abcdef"
    GenericSuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          nullable: true
        message:
          type: string
          example: "Operation successful."
        meta:
          type: object
          nullable: true
    GenericErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: "Internal Server Error"
        message:
          type: string
          example: "Failed to process request."
        meta:
          type: object
          nullable: true
paths:
  /health:
    get:
      summary: Health check
      tags:
        - Health
      responses:
        '200':
          description: Email Service is healthy.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ok"
